<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>COVID-19 Graphs</title>
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet"> 
        <style>
            html {
                font-family: 'Montserrat', sans-serif;
                font-size: 1.25rem;
                background-color: #fff;
            }

            #app {
                padding: 0 1rem; 
                max-width: 1400px; 
                margin: auto;
            }

            .causes > div {
                width: 300px;
                font-size: 0.8rem;
                padding: 10px 0;
                cursor: pointer;
            }

            .causes label {
                cursor: pointer;
                padding-left: 5px;
            }

            .causes {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }

            .summary {
                text-align: center; 
                border: 1px solid #333; 
                background-color: #efefef;
            }

            .disclaimer {
                text-align: center;
                font-size: 0.8rem;
                font-style: italic;
                margin: 20px 0;
            }

            .summary span {
                font-weight: bold;
            }

            .summary > div {
                padding: 10px 0;
            }

            .container {
                margin: 40px 0;
            }

            #state {
                width: 100%; 
                height: 40px;
            }

            @media only screen and (min-width: 1000px) {
                .container {
                    display: flex;
                    flex-wrap: wrap;
                }

                .container > .controls {
                    width: 20%;
                    padding-left: 5%;
                    order: 2;
                }

                .container > #graphs {
                    width: 75%;
                    order: 1;
                }
            }
        </style>
        <script>
            class Dashboard {
                constructor(data) {
                    this.data = data
                    this.mappedData = {}
                    this.chart1 = null
                    this.chart2 = null

                    this.mapData()
                    this.createChart()
                }

                mapData() {
                    function color(state, date) {
                        if (mandates[state] === -1) {
                            return 'grey'
                        } else if (mandates[state] === 0 || date < mandates[state]) {
                            return 'red'
                        } else {
                            return 'blue'
                        }
                    }

                    this.data.forEach(el =>{
                        this.mappedData[el.state] = this.mappedData[el.state] || {}
                        
                        this.mappedData[el.state]['new'] = this.mappedData[el.state]['new'] || {}
                        this.mappedData[el.state]['new'].data = this.mappedData[el.state]['new'].data || []
                        this.mappedData[el.state]['new'].colors = this.mappedData[el.state]['new'].colors || []
                        this.mappedData[el.state]['new'].dates = this.mappedData[el.state]['new'].dates || []
                        this.mappedData[el.state]['new'].data.unshift(el.positiveIncrease)
                        this.mappedData[el.state]['new'].colors.unshift(color(el.state, el.date))
                        this.mappedData[el.state]['new'].dates.unshift(el.date)
        
                        this.mappedData[el.state]['total'] = this.mappedData[el.state]['total'] || {}
                        this.mappedData[el.state]['total'].data = this.mappedData[el.state]['total'].data || []
                        this.mappedData[el.state]['total'].colors = this.mappedData[el.state]['total'].colors || []
                        this.mappedData[el.state]['total'].dates = this.mappedData[el.state]['total'].dates || []
                        this.mappedData[el.state]['total'].data.unshift(el.positive)
                        this.mappedData[el.state]['total'].colors.unshift(color(el.state, el.date))
                        this.mappedData[el.state]['total'].dates.unshift(el.date)
                    })
                }

                createChart() {
                    var ctx1 =  document.getElementById('graph1').getContext('2d')
                    this.chart1 = new Chart(ctx1, {
                        type: 'bar',
                        data: {},
                        options: {
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }]
                            },
                            title: {
                                display: true,
                                fontSize: '32',
                                fontColor: '#333',
                                text: 'New positive cases'
                            },
                            legend: {
                                display: false
                            }
                        }
                    })

                    var ctx2 =  document.getElementById('graph2').getContext('2d')
                    this.chart2 = new Chart(ctx2, {
                        type: 'line',
                        data: {},
                        options: {
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }]
                            },
                            title: {
                                display: true,
                                fontSize: '32',
                                fontColor: '#333',
                                text: 'Total cases'
                            },
                            legend: {
                                display: false
                            }
                        }
                    })
                }

                update() {
                    var typeSelector = document.getElementById("type")
                    var stateSelector = document.getElementById("state")
                    var state = stateSelector.value

                    this.chart1.data = {
                        labels: this.mappedData[state]['new'].dates,
                        datasets: [{
                            data: this.mappedData[state]['new'].data,
                            backgroundColor: this.mappedData[state]['new'].colors,
                            borderColor: this.mappedData[state]['new'].colors
                        }]
                    }
                    this.chart1.update();

                    this.chart2.data = {
                        labels: this.mappedData[state]['total'].dates,
                        datasets: [{
                            data: this.mappedData[state]['total'].data,
                            backgroundColor: this.mappedData[state]['total'].colors,
                            borderColor: this.mappedData[state]['total'].colors
                        }]
                    }
                    this.chart2.update();
                }
            }
        </script>
    </head>
    <body>
        <div id="app">
            <p style='text-align: center;'>
                I saw this image on Facebook: <p><img src='../img/covid.jpg' style='display: block; margin: auto;'></p> The implication was pretty strong, but it didn't really provide much information/context to it. I wanted to know more. Luckily, after looking into the data-source, I found that there was an API available. I finally had an excuse to build my own COVID-19 dashboard. 
            </p>

            <p>
                There were a few things I wanted to know from the original graph:
                <ol>
                    <li>Actual numbers</li>
                    <li>Breakdown by state/territory</li>
                    <li>Mask mandates by state (and when they went into effect)</li>
                </ol>
            </p>

            <p>
                In the graphs below, red values are taken from dates without a mask mandate, blue values are taken from dates with a mask mandate, and grey values are unknown.
            </p>
            
            <div class='container'>
                <div class='controls'>
                    <h3>State/Territory</h3>
                    <select name="state" id="state" onchange="dashboard.update()">
                        <option></option>
                        <option value="AL">AL</option>
                        <option value="AK">AK</option>
                        <option value="AZ">AZ</option>
                        <option value="AR">AR</option>
                        <option value="AS">AS</option>
                        <option value="CA">CA</option>
                        <option value="CO">CO</option>
                        <option value="CT">CT</option>
                        <option value="DC">DC</option>
                        <option value="DE">DE</option>
                        <option value="FL">FL</option>
                        <option value="GA">GA</option>
                        <option value="GU">GU</option>
                        <option value="HI">HI</option>
                        <option value="ID">ID</option>
                        <option value="IL">IL</option>
                        <option value="IN">IN</option>
                        <option value="IA">IA</option>
                        <option value="KS">KS</option>
                        <option value="KY">KY</option>
                        <option value="LA">LA</option>
                        <option value="ME">ME</option>
                        <option value="MD">MD</option>
                        <option value="MA">MA</option>
                        <option value="MI">MI</option>
                        <option value="MN">MN</option>
                        <option value="MS">MS</option>
                        <option value="MO">MO</option>
                        <option value="MP">MP</option>
                        <option value="MT">MT</option>
                        <option value="NE">NE</option>
                        <option value="NV">NV</option>
                        <option value="NH">NH</option>
                        <option value="NJ">NJ</option>
                        <option value="NM">NM</option>
                        <option value="NY">NY</option>
                        <option value="NC">NC</option>
                        <option value="ND">ND</option>
                        <option value="OH">OH</option>
                        <option value="OK">OK</option>
                        <option value="OR">OR</option>
                        <option value="PA">PA</option>
                        <option value="PR">PR</option>
                        <option value="RI">RI</option>
                        <option value="SC">SC</option>
                        <option value="SD">SD</option>
                        <option value="TN">TN</option>
                        <option value="TX">TX</option>
                        <option value="UT">UT</option>
                        <option value="VT">VT</option>
                        <option value="VA">VA</option>
                        <option value="VI">VI</option>
                        <option value="WA">WA</option>
                        <option value="WV">WV</option>
                        <option value="WI">WI</option>
                        <option value="WY">WY</option>
                    </select>
                </div>
                
                <div id="graphs">
                    <canvas id='graph1' height=125></canvas>
                    <canvas id='graph2' height=125></canvas>
                </div>
            </div>
            
            <h2>Conclusions</h2>
            <p>
                Really, I have no clue. These graphs are still very basic, and don't provide a lot context. I just wanted a chance to play with the data myself, and to improve on the original Facebook graph. There are studies that show that mask mandates are effective, and they were analyzed by people much more knowledgable than me: <a href="https://www.npr.org/sections/health-shots/2020/11/23/937173060/mask-mandates-work-to-slow-spread-of-coronavirus-kansas-study-finds">NPR: Mask Mandates Work To Slow Spread Of Coronavirus, Kansas Study Finds</a>
            </p>
            
            <div class='disclaimer'>
                <div>Case data: <a href="https://covidtracking.com/">https://covidtracking.com/</a></div> 
                <div>Mandate data: <a href="https://masks4all.co/what-states-require-masks/">https://masks4all.co/what-states-require-masks/</a></div>
            </div>

        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
        <script src="./case-data.js"></script>
        <script src="./mask-mandates.js"></script>
        <script>
            var dashboard = new Dashboard(data)
        </script>
    </body>
</html>
